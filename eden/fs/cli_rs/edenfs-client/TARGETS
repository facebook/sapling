load("@fbcode_macros//build_defs:rust_library.bzl", "rust_library")
load("@fbsource//tools/build_defs:glob_defs.bzl", "glob")

oncall("scm_client_infra")

rust_library(
    name = "edenfs-client",
    srcs = glob(["src/**/*.rs"]),
    os_deps = [
        (
            "windows",
            [
                "//eden/scm/exec/scratch:mkscratch",
            ],
        ),
        (
            "macos",
            [
                "fbsource//third-party/rust:psutil",
            ],
        ),
    ],
    test_deps = [
        "fbsource//third-party/rust:rand",
        "fbsource//third-party/rust:serde_test",
        "fbsource//third-party/rust:tempfile",
    ],
    deps = [
        "fbsource//third-party/rust:anyhow",
        "fbsource//third-party/rust:async-recursion",
        "fbsource//third-party/rust:byteorder",
        "fbsource//third-party/rust:dirs",
        "fbsource//third-party/rust:futures",
        "fbsource//third-party/rust:pathdiff",
        "fbsource//third-party/rust:regex",
        "fbsource//third-party/rust:serde",
        "fbsource//third-party/rust:serde_json",
        "fbsource//third-party/rust:shlex",
        "fbsource//third-party/rust:subprocess",
        "fbsource//third-party/rust:sysinfo",
        "fbsource//third-party/rust:tokio",
        "fbsource//third-party/rust:toml",
        "fbsource//third-party/rust:tracing",
        "fbsource//third-party/rust:uuid",
        "//common/rust/shed/fbinit:fbinit",
        "//common/rust/shed/fbthrift_ext:socket",
        "//common/rust/shed/tokio-uds-compat:tokio-uds-compat",
        "//common/rust/thrift/bareclient:thriftclient",
        "//eden/fs/cli_rs/edenfs-config:edenfs-config",
        "//eden/fs/cli_rs/edenfs-error:edenfs-error",
        "//eden/fs/cli_rs/edenfs-utils:edenfs-utils",
        "//eden/fs/cli_rs/facebook/edenfs-telemetry:edenfs-telemetry",
        "//eden/fs/service:thrift-streaming-rust",
        "//eden/fs/service:thrift-streaming-rust-thriftclients",
        "//eden/scm/lib/atomicfile:atomicfile",
        "//eden/scm/lib/thrift-types:thrift-types",
        "//eden/scm/lib/util:util",
    ],
)
