#chg-compatible
#debugruntest-incompatible

#require execbit

  $ eagerepo
  $ . "$TESTDIR/helpers-testrepo.sh"
  $ cd "`dirname "$TESTDIR"`"

  $ testrepohg files . > "$TESTTMP/filelist"

  $ python << EOF
  > import os, stat
  > for path in open(os.path.join(os.environ["TESTTMP"], "filelist")).read().splitlines():
  >     if path.startswith("fb/") or path.startswith("tests/sapling"):
  >         continue
  >     content = open(path, "rb").read()
  >     isexec = bool(stat.S_IEXEC & os.stat(path).st_mode)
  >     ispy = path.endswith(".py")
  >     issh = path.endswith(".sh")
  >     isrs = path.endswith(".rs")
  >     if content.startswith(b"#!"):
  >         interpreter = os.path.basename(content.split(b"\n")[0].split()[-1])
  >     else:
  >         interpreter = None
  >     if ispy and isexec and interpreter not in {b"python", b"python3", b"python3.8", b"debugpython", b"dbsh", b"debugshell"}:
  >         print("%s is a Python script but does not have Python interpreter specified" % path)
  >     elif issh and isexec and interpreter not in {b"sh", b"bash", b"zsh", b"fish"}:
  >         print("%s is a Shell script but does not have Shell interpreter specified" % path)
  >     elif isexec and not interpreter:
  >         print("%s is executable but does not have #!" % path)
  >     elif not isexec and interpreter and not isrs:
  >         print("%s is not an executable but does have #!" % path)
  > EOF
  run_buck_hgpython.sh is a Shell script but does not have Shell interpreter specified
  tests/infinitepush/library.sh is not an executable but does have #!
  tests/stresstest-atomicreplace.py is not an executable but does have #!
