---
phase: 02-stack-column
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - addons/isl/src/PRDashboard.tsx
  - addons/isl/src/PRDashboard.css
autonomous: true

must_haves:
  truths:
    - "Clicking a PR row triggers checkout to that PR's head commit"
    - "Clicking a stack card header triggers checkout to the stack's top PR"
    - "Entire row/card is clickable, not just a button"
    - "Hover shows pointer cursor and subtle highlight"
    - "Re-clicking already checked-out item is a no-op"
    - "Visual feedback shows during checkout operation"
  artifacts:
    - path: "addons/isl/src/PRDashboard.tsx"
      provides: "Click-to-checkout functionality on PR rows and stack cards"
      exports: ["PRDashboard"]
    - path: "addons/isl/src/PRDashboard.css"
      provides: "Hover states and clickable cursor styles"
      contains: "cursor: pointer"
  key_links:
    - from: "addons/isl/src/PRDashboard.tsx"
      to: "GotoOperation"
      via: "useRunOperation hook"
      pattern: "runOperation.*GotoOperation"
---

<objective>
Add click-to-checkout functionality to PR stack items

Purpose: Users can navigate the PR stack by clicking any commit/PR to check it out, not just using the pull button. This matches the "single click triggers checkout" decision from CONTEXT.md.

Output: PRDashboard with clickable rows that trigger checkout operations
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-stack-column/02-CONTEXT.md
@.planning/phases/02-stack-column/02-RESEARCH.md

@addons/isl/src/PRDashboard.tsx
@addons/isl/src/PRDashboard.css
@addons/isl/src/Commit.tsx (lines 889-910 for gotoAction pattern)
@addons/isl/src/operations/GotoOperation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add click-to-checkout on PR rows</name>
  <files>addons/isl/src/PRDashboard.tsx</files>
  <action>
Add click-to-checkout functionality to PRRow component:

1. Import GotoOperation from './operations/GotoOperation'
2. Import succeedableRevset from './types'
3. Import dagWithPreviews from './previews' and useAtomValue from 'jotai'
4. Import inlineProgressByHash from './operationsState'

5. In PRRow component:
   - Get runOperation from useRunOperation() (already imported)
   - Get dag from useAtomValue(dagWithPreviews)
   - Get the headHash from pr (already extracted as: const headHash = pr.type === 'github' ? pr.head : undefined)
   - Check if this PR is currently checked out: const isCurrentCommit = headHash ? dag.resolve('.')?.hash === headHash : false
   - Get inline progress: const inlineProgress = useAtomValue(inlineProgressByHash(headHash ?? ''))

6. Create handleCheckout function:
   ```typescript
   const handleCheckout = useCallback(() => {
     if (!headHash || isCurrentCommit) return;
     runOperation(new GotoOperation(succeedableRevset(headHash)));
   }, [headHash, isCurrentCommit, runOperation]);
   ```

7. Add onClick handler to the pr-row div:
   - onClick={handleCheckout}
   - Add cursor: pointer via className when clickable

8. Add visual feedback:
   - If inlineProgress is set, show loading indicator (use Icon icon="loading")
   - If isCurrentCommit, add 'pr-row-current' class

9. Ensure child clickable elements (PR number link, view changes button) call event.stopPropagation() to prevent checkout - the PR number link already has onClick={e => e.stopPropagation()}, add same to view changes button.
  </action>
  <verify>TypeScript compiles without errors: cd addons/isl && yarn build</verify>
  <done>Clicking a PR row triggers GotoOperation with the PR's head commit hash, except when already checked out or when clicking child links/buttons</done>
</task>

<task type="auto">
  <name>Task 2: Add click-to-checkout on stack card headers</name>
  <files>addons/isl/src/PRDashboard.tsx</files>
  <action>
Add click-to-checkout functionality to StackCard component header:

1. In StackCard component:
   - Import and use dagWithPreviews to get current head
   - Get the top PR's head hash: const topHeadHash = stack.prs[0]?.type === 'github' ? stack.prs[0].head : undefined
   - Check if stack top is currently checked out: const isCurrentStack = topHeadHash ? dag.resolve('.')?.hash === topHeadHash : false
   - Get inline progress for the top commit

2. Create handleStackCheckout function:
   ```typescript
   const handleStackCheckout = useCallback(() => {
     if (!topHeadHash || isCurrentStack) return;
     runOperation(new GotoOperation(succeedableRevset(topHeadHash)));
   }, [topHeadHash, isCurrentStack, runOperation]);
   ```

3. Update stack-card-header to be clickable:
   - Add onClick={handleStackCheckout} to the header div
   - Add cursor: pointer class when clickable
   - Ensure expand button and other buttons call stopPropagation

4. Add current-stack indicator:
   - If isCurrentStack, add 'stack-card-current' class

5. Ensure existing click handlers on child elements prevent propagation:
   - toggleExpanded already works via Button onClick
   - Add stopPropagation to action buttons if needed
  </action>
  <verify>TypeScript compiles without errors: cd addons/isl && yarn build</verify>
  <done>Clicking stack card header triggers checkout to the stack's top PR, except when already checked out or clicking child elements</done>
</task>

<task type="auto">
  <name>Task 3: Add hover states and visual feedback CSS</name>
  <files>addons/isl/src/PRDashboard.css</files>
  <action>
Add CSS for clickable hover states and current-commit indicators:

1. Add clickable PR row styles:
   ```css
   .pr-row-clickable {
     cursor: pointer;
   }

   .pr-row-clickable:hover {
     background: var(--hover-darken);
   }
   ```

2. Add current PR row indicator:
   ```css
   .pr-row-current {
     background: var(--selected-commit-background, rgba(74, 144, 226, 0.15));
     border-left: 2px solid var(--graphite-accent, #4a90e2);
   }

   .pr-row-current:hover {
     background: var(--selected-commit-background, rgba(74, 144, 226, 0.15));
     cursor: default;
   }
   ```

3. Add clickable stack header styles:
   ```css
   .stack-card-header-clickable {
     cursor: pointer;
   }

   .stack-card-header-clickable:hover {
     background: var(--hover-darken);
   }
   ```

4. Add current stack indicator:
   ```css
   .stack-card-current {
     border-left: 3px solid var(--graphite-accent, #4a90e2);
   }

   .stack-card-current .stack-card-header {
     background: var(--selected-commit-background, rgba(74, 144, 226, 0.15));
   }
   ```

5. Add loading state for checkout in progress:
   ```css
   .pr-row-loading,
   .stack-card-loading {
     opacity: 0.7;
     pointer-events: none;
   }
   ```
  </action>
  <verify>CSS is valid and styles are applied correctly</verify>
  <done>Hover states show pointer cursor and subtle highlight, current items have visual indicator, loading state dims the row</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd addons/isl && yarn build`
2. Lint passes: `cd addons/isl && yarn eslint`
3. Manual verification: Start dev server (`yarn dev`), click a PR row, observe checkout operation
</verification>

<success_criteria>
- Clicking any PR row triggers checkout to that PR's head commit
- Clicking a stack card header triggers checkout to the stack's top PR
- Already checked-out items don't trigger redundant operations
- Hover states show pointer cursor and highlight
- Child clickable elements (links, buttons) don't trigger parent checkout
- Loading feedback appears during checkout operation
</success_criteria>

<output>
After completion, create `.planning/phases/02-stack-column/02-01-SUMMARY.md`
</output>
