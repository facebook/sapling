---
phase: 02-stack-column
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - addons/isl/src/CommitTreeList.tsx
  - addons/isl/src/CommitTreeList.css
  - addons/isl/src/Commit.tsx
autonomous: true

must_haves:
  truths:
    - "origin/main is visually highlighted in the commit tree (middle column)"
    - "origin/main marker is moderately prominent (noticeable but not dominating)"
    - "Clicking origin/main in history triggers checkout (same as other commits)"
    - "origin/main has consistent visual treatment with Graphite color scheme"
  artifacts:
    - path: "addons/isl/src/CommitTreeList.tsx"
      provides: "Detection of origin/main commits for highlighting"
      exports: ["CommitTreeList"]
    - path: "addons/isl/src/CommitTreeList.css"
      provides: "Visual styling for origin/main highlighting"
      contains: "origin-main"
    - path: "addons/isl/src/Commit.tsx"
      provides: "Origin/main badge rendering on commit rows"
      exports: ["Commit"]
  key_links:
    - from: "addons/isl/src/Commit.tsx"
      to: "commit.remoteBookmarks"
      via: "checking for main/master bookmarks"
      pattern: "remoteBookmarks.*main|master"
---

<objective>
Add visual highlighting for origin/main in commit tree

Purpose: Users can easily identify origin/main in the commit history with a moderately prominent visual marker. This helps with navigation and understanding where the main branch is relative to their work.

Output: Commit tree with highlighted origin/main commits that are clickable for checkout
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-stack-column/02-CONTEXT.md
@.planning/phases/02-stack-column/02-RESEARCH.md

@addons/isl/src/CommitTreeList.tsx
@addons/isl/src/CommitTreeList.css
@addons/isl/src/Commit.tsx
@addons/isl/src/Bookmark.tsx (for existing bookmark styling patterns)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add origin/main detection helper</name>
  <files>addons/isl/src/CommitTreeList.tsx</files>
  <action>
Add a helper to detect if a commit is origin/main:

1. Add a new atom or utility function to detect origin/main commits:
   ```typescript
   /**
    * Check if a commit has origin/main or origin/master bookmark.
    * Used to apply special highlighting to the main branch marker.
    */
   function isOriginMain(commit: DagCommitInfo): boolean {
     return commit.remoteBookmarks.some(
       bookmark =>
         bookmark === 'origin/main' ||
         bookmark === 'origin/master' ||
         bookmark === 'remote/main' ||
         bookmark === 'remote/master'
     );
   }
   ```

2. Export this function for use in other components:
   ```typescript
   export {isOriginMain};
   ```

3. Alternatively, create an atomFamilyWeak for memoized detection:
   ```typescript
   const isOriginMainAtom = atomFamilyWeak((hash: string) =>
     atom(get => {
       const dag = get(dagWithPreviews);
       const commit = dag.get(hash);
       if (!commit) return false;
       return commit.remoteBookmarks.some(
         bookmark =>
           bookmark === 'origin/main' ||
           bookmark === 'origin/master' ||
           bookmark === 'remote/main' ||
           bookmark === 'remote/master'
       );
     }),
   );
   ```

The simpler function approach is preferred since the commit info is already available in render.
  </action>
  <verify>TypeScript compiles: cd addons/isl && yarn build</verify>
  <done>isOriginMain helper function exists to detect main branch commits</done>
</task>

<task type="auto">
  <name>Task 2: Add origin/main visual marker to Commit component</name>
  <files>addons/isl/src/Commit.tsx</files>
  <action>
Add visual highlighting for origin/main commits in the Commit component:

1. Import the helper at top of file (or define inline):
   ```typescript
   // Helper to detect origin/main
   function isOriginMain(commit: CommitInfo | DagCommitInfo): boolean {
     return commit.remoteBookmarks.some(
       bookmark =>
         bookmark === 'origin/main' ||
         bookmark === 'origin/master' ||
         bookmark === 'remote/main' ||
         bookmark === 'remote/master'
     );
   }
   ```

2. In the Commit component, detect if this commit is origin/main:
   ```typescript
   const isMainBranch = isOriginMain(commit);
   ```

3. Add a class to the commit div when it's origin/main:
   ```typescript
   return (
     <div
       className={
         'commit' +
         (commit.isDot ? ' head-commit' : '') +
         (commit.successorInfo != null ? ' obsolete' : '') +
         (isIrrelevantToCwd ? ' irrelevant' : '') +
         (isMainBranch ? ' origin-main-commit' : '')  // Add this line
       }
       // ... rest of props
     >
   ```

4. Add a small visual badge/indicator near the commit title for origin/main:
   In the commit-details section, after the title span, add:
   ```typescript
   {isMainBranch && (
     <span className="origin-main-badge">
       <Icon icon="git-branch" />
       main
     </span>
   )}
   ```

   Place this within the DragToRebase component, after the title:
   ```typescript
   {isPublic ? null : (
     <span className="commit-title">
       {commitLabel && <CommitLabel>{commitLabel}</CommitLabel>}
       <span>{title}</span>
       <CommitDate date={commit.date} />
     </span>
   )}
   {isMainBranch && (
     <span className="origin-main-badge">
       <Icon icon="git-branch" />
       <span>main</span>
     </span>
   )}
   ```

Note: The existing Bookmark component already renders remote bookmarks including "origin/main" via AllBookmarksTruncated. This task adds additional highlighting beyond just the bookmark name - a distinct visual marker that makes origin/main stand out more.
  </action>
  <verify>TypeScript compiles: cd addons/isl && yarn build</verify>
  <done>Commit component shows special badge/indicator for origin/main commits</done>
</task>

<task type="auto">
  <name>Task 3: Style origin/main highlighting</name>
  <files>addons/isl/src/CommitTreeList.css</files>
  <action>
Add CSS for origin/main visual highlighting:

1. Add origin-main commit row styling (moderately prominent, not dominating):
   ```css
   /* Origin/main commit highlighting */
   .commit.origin-main-commit {
     /* Subtle left border to indicate main branch */
     border-left: 2px solid var(--graphite-accent, #4a90e2);
     margin-left: -2px;
   }

   .commit.origin-main-commit .commit-details {
     /* Very subtle background tint */
     background: linear-gradient(
       90deg,
       rgba(74, 144, 226, 0.08) 0%,
       transparent 50%
     );
   }
   ```

2. Add origin-main badge styling:
   ```css
   .origin-main-badge {
     display: inline-flex;
     align-items: center;
     gap: 4px;
     padding: 2px 8px;
     margin-left: var(--halfpad);
     font-size: 11px;
     font-weight: 500;
     color: var(--graphite-accent, #4a90e2);
     background: rgba(74, 144, 226, 0.12);
     border-radius: 3px;
     flex-shrink: 0;
   }

   .origin-main-badge .codicon {
     font-size: 12px;
   }
   ```

3. Ensure the highlight doesn't conflict with other states:
   ```css
   /* Origin/main when also head commit */
   .commit.origin-main-commit.head-commit {
     border-left-color: var(--graphite-accent, #4a90e2);
   }

   /* Origin/main when selected */
   .commit-row-selected .commit.origin-main-commit {
     /* Keep the selection styling, subtle adjustment */
   }
   ```

4. The styling should be "moderately prominent" per CONTEXT.md - noticeable but not garish:
   - Use the Graphite accent color (#4a90e2) for consistency
   - Small badge rather than large banner
   - Subtle background gradient rather than solid color
   - Border accent rather than full highlight
  </action>
  <verify>CSS is valid, visual appearance is moderately prominent</verify>
  <done>Origin/main has consistent visual treatment with Graphite color scheme, moderately prominent appearance</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd addons/isl && yarn build`
2. Lint passes: `cd addons/isl && yarn eslint`
3. Manual verification:
   - Origin/main commit shows badge and subtle highlight
   - Visual treatment is noticeable but not overwhelming
   - Clicking origin/main triggers checkout (existing behavior)
   - Works with other commit states (selected, head, obsolete)
</verification>

<success_criteria>
- origin/main is visually highlighted in commit tree
- Highlighting is moderately prominent (noticeable but not dominating)
- Badge shows "main" text with branch icon
- Subtle left border and background gradient
- Uses Graphite color scheme consistently
- Clicking origin/main triggers checkout (no change to existing behavior)
</success_criteria>

<output>
After completion, create `.planning/phases/02-stack-column/02-03-SUMMARY.md`
</output>
