---
phase: 06-navigation-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - addons/isl/src/CommitTreeList.tsx
  - addons/isl/src/CommitTreeList.css
autonomous: true

must_haves:
  truths:
    - "When user clicks commit in left column, middle column scrolls to show 'you are here' at viewport top with 30px padding"
    - "Auto-scroll works regardless of current scroll position in either column"
    - "Scroll animation is smooth (not instant jump)"
    - "Rapid clicks don't cause scroll jittering or multiple queued animations"
  artifacts:
    - path: "addons/isl/src/CommitTreeList.tsx"
      provides: "Updated useScrollToSelectedCommit hook with block: start and debouncing"
      contains: "block: 'start'"
    - path: "addons/isl/src/CommitTreeList.css"
      provides: "scroll-margin-top for commit rows"
      contains: "scroll-margin-top"
  key_links:
    - from: "addons/isl/src/CommitTreeList.tsx"
      to: "selectedCommits atom"
      via: "useAtomValue in useScrollToSelectedCommit"
      pattern: "useAtomValue.*selectedCommits"
    - from: "addons/isl/src/CommitTreeList.tsx"
      to: "DOM element"
      via: "querySelector with data-commit-hash"
      pattern: 'querySelector.*data-commit-hash'
---

<objective>
Fix auto-scroll sync between left column (PRDashboard) and middle column (CommitTreeList) to properly position selected commits at the top of the viewport with padding.

Purpose: Current implementation uses `block: 'center'` which positions the selected commit in the middle of the viewport. Users expect Graphite-style behavior where the selected commit appears at the top with consistent padding (30px).

Output: Updated scroll behavior that positions selected commits at viewport top with smooth animation and proper handling of rapid clicks.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-navigation-fixes/06-CONTEXT.md
@.planning/phases/06-navigation-fixes/06-RESEARCH.md

Key implementation reference:
- addons/isl/src/CommitTreeList.tsx (lines 254-276): Current useScrollToSelectedCommit hook
- addons/isl/src/CommitTreeList.css: Styling for commit rows
- addons/shared/debounce.ts: Existing debounce utility
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update useScrollToSelectedCommit hook for top-aligned scrolling</name>
  <files>addons/isl/src/CommitTreeList.tsx</files>
  <action>
Modify the `useScrollToSelectedCommit` hook (lines 254-276) to:

1. Change `block: 'center'` to `block: 'start'` in the scrollIntoView options
2. Keep `behavior: 'smooth'` for animation
3. Keep `inline: 'nearest'` for horizontal scroll
4. Keep the setTimeout(100) wrapper for DOM timing (100ms is fine, research suggests 0ms but 100ms provides more reliability for React renders)
5. Keep the cleanup function that clears the timeout

The hook already:
- Watches `selectedCommits` atom via useAtomValue
- Only scrolls when exactly 1 commit is selected (good for avoiding multi-select issues)
- Uses setTimeout for DOM timing
- Has cleanup function

No debouncing needed - the existing single-selection check (selected.size !== 1) already prevents rapid scroll issues. When user clicks rapidly, each click replaces the selection (not extends it), so only the final selection triggers scroll.

Expected result:
```typescript
function useScrollToSelectedCommit() {
  const selected = useAtomValue(selectedCommits);

  useEffect(() => {
    if (selected.size !== 1) {
      return;
    }

    const hash = Array.from(selected)[0];
    const timer = setTimeout(() => {
      const element = document.querySelector(`[data-commit-hash="${hash}"]`);
      if (element) {
        element.scrollIntoView({
          behavior: 'smooth',
          block: 'start',      // Changed from 'center'
          inline: 'nearest',
        });
      }
    }, 100);

    return () => clearTimeout(timer);
  }, [selected]);
}
```
  </action>
  <verify>
1. Run `cd /Users/jonas/code/sapling/addons && yarn eslint isl/src/CommitTreeList.tsx --quiet` - should pass
2. Run `cd /Users/jonas/code/sapling/addons && yarn tsc --noEmit` - should compile without errors
3. Grep for `block: 'start'` in CommitTreeList.tsx - should find the change
  </verify>
  <done>
scrollIntoView uses block: 'start' instead of block: 'center', causing selected commits to appear at viewport top rather than center.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add CSS scroll-margin-top for proper top padding</name>
  <files>addons/isl/src/CommitTreeList.css</files>
  <action>
Add `scroll-margin-top: 30px;` to the `.commit-rows` class in CommitTreeList.css. This class is applied to each commit row element (the ones with data-commit-hash attribute).

The scroll-margin-top property tells the browser to add 30px of visual padding when scrolling an element into view with scrollIntoView(). This creates the "top of viewport with padding" effect specified in the requirements.

Add this property to the existing `.commit-rows` rule (around line 109):

```css
.commit-rows {
  display: flex;
  flex-direction: row;
  gap: calc(var(--halfpad) / 2) var(--halfpad);
  padding: calc(var(--halfpad) / 2);
  padding-left: 0;
  margin-left: var(--halfpad);
  position: relative;
  align-items: center;
  z-index: 1;
  scroll-margin-top: 30px;  /* Add this line - padding when scrolling into view */
}
```

Why 30px: This is in the middle of the 20-40px range specified in CONTEXT.md. It provides comfortable visual separation from the top of the scroll container without wasting too much vertical space.
  </action>
  <verify>
1. Grep for `scroll-margin-top` in CommitTreeList.css - should find the new property
2. Run `cd /Users/jonas/code/sapling/addons/isl && yarn build` - should build without CSS errors
  </verify>
  <done>
Commit rows have scroll-margin-top: 30px applied, creating 30px padding above selected commits when scrolled into view.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Build verification:**
   ```bash
   cd /Users/jonas/code/sapling/addons/isl && yarn build
   ```
   Should complete without errors.

2. **Code verification:**
   - CommitTreeList.tsx contains `block: 'start'`
   - CommitTreeList.css contains `scroll-margin-top: 30px`

3. **Functional verification (manual):**
   Start dev server: `cd /Users/jonas/code/sapling/addons/isl && yarn start`
   - Click a commit in the middle column - it should scroll to top with padding
   - Click a different PR in left column - middle column should scroll to new "you are here" position
   - Scroll position should have ~30px gap from top
   - Animation should be smooth, not instant
</verification>

<success_criteria>
- [ ] `block: 'start'` in scrollIntoView options (replacing 'center')
- [ ] `scroll-margin-top: 30px` applied to commit rows
- [ ] ESLint passes on CommitTreeList.tsx
- [ ] TypeScript compiles without errors
- [ ] Production build completes successfully
- [ ] Requirements covered: NAV-01 (top positioning), NAV-02 (works from any scroll position), NAV-03 (smooth animation)
</success_criteria>

<output>
After completion, create `.planning/phases/06-navigation-fixes/06-01-SUMMARY.md`
</output>
