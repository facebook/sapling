---
phase: 04-details-panel
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - addons/isl/src/CommitInfoView/CommitInfoView.tsx
  - addons/isl/src/CommitInfoView/CommitInfoView.css
autonomous: true

must_haves:
  truths:
    - "Files Changed section appears above Changes to Amend section"
    - "Changes to Amend section is collapsed by default"
    - "User can expand Changes to Amend by clicking the header"
    - "Collapsed state resets when selecting a different commit"
  artifacts:
    - path: "addons/isl/src/CommitInfoView/CommitInfoView.tsx"
      provides: "Reordered sections with collapsible amend"
      contains: "Collapsable"
  key_links:
    - from: "CommitInfoView.tsx"
      to: "Collapsable component"
      via: "import and usage"
      pattern: "import.*Collapsable"
---

<objective>
Reorganize details panel hierarchy: Files Changed section becomes primary (moved up), Changes to Amend section becomes secondary (collapsed by default).

Purpose: De-emphasize amend workflow to focus user attention on what changed in the commit.
Output: Reordered panel with collapsible amend section.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-details-panel/04-CONTEXT.md
@.planning/phases/04-details-panel/04-RESEARCH.md
@addons/isl/src/CommitInfoView/CommitInfoView.tsx
@addons/isl/src/Collapsable.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Reorder sections and wrap amend in Collapsable</name>
  <files>addons/isl/src/CommitInfoView/CommitInfoView.tsx</files>
  <action>
In CommitInfoView.tsx around lines 394-433:

1. **Import Collapsable** at top of file:
   ```typescript
   import {Collapsable} from '../Collapsable';
   ```

2. **Swap section order** - Move "Files Changed" section (lines 415-433) ABOVE "Changes to Amend" section (lines 394-414):
   - The `{isCommitMode ? null : (<Section data-testid="committed-changes">...)}` block moves first
   - The `{commit.isDot && !isAmendDisabled ? (<Section data-testid="changes-to-amend">...)}` block moves second

3. **Wrap amend section in Collapsable** with collapsed default:
   ```typescript
   {commit.isDot && !isAmendDisabled ? (
     <Collapsable
       startExpanded={false}
       title={
         <SmallCapsTitle>
           {isCommitMode ? <T>Changes to Commit</T> : <T>Changes to Amend</T>}
           <Badge>
             {selectedFilesLength === uncommittedChanges.length
               ? null
               : selectedFilesLength + '/'}
             {uncommittedChanges.length}
           </Badge>
         </SmallCapsTitle>
       }
     >
       <div data-testid="changes-to-amend">
         {uncommittedChanges.length > 0 ? <PendingDiffStats /> : null}
         {uncommittedChanges.length === 0 ? (
           <Subtle>
             {isCommitMode ? <T>No changes to commit</T> : <T>No changes to amend</T>}
           </Subtle>
         ) : (
           <UncommittedChanges place={isCommitMode ? 'commit sidebar' : 'amend sidebar'} />
         )}
       </div>
     </Collapsable>
   ) : null}
   ```

**Key changes:**
- Remove outer `<Section>` wrapper from amend block (Collapsable provides its own container)
- Move `data-testid="changes-to-amend"` to inner div (preserves test compatibility)
- Title includes SmallCapsTitle with Badge (matches current visual)
- `startExpanded={false}` ensures collapsed by default
- No state persistence (Collapsable internal state resets on remount, which happens on commit change)

**Preserve:**
- All conditional rendering logic (`commit.isDot`, `isAmendDisabled`, `isCommitMode`)
- Both `data-testid` attributes for test compatibility
- Badge showing file count with selected ratio
  </action>
  <verify>
- `yarn eslint` passes in addons/isl
- `yarn test` passes (especially CommitInfoView tests)
- Visual inspection: Files Changed section appears first, Changes to Amend is collapsed
  </verify>
  <done>
- Files Changed section renders above Changes to Amend
- Changes to Amend section is collapsed by default
- Clicking amend header expands the section
- Both data-testid attributes present for test compatibility
  </done>
</task>

<task type="auto">
  <name>Task 2: Style adjustments for visual hierarchy</name>
  <files>addons/isl/src/CommitInfoView/CommitInfoView.css</files>
  <action>
Add CSS to establish visual hierarchy between primary (Files Changed) and secondary (Changes to Amend) sections.

1. **Add margin between sections** to visually separate:
   ```css
   .commit-info-view-main-content > .collapsable {
     margin-top: var(--pad);
   }
   ```

2. **Subtle styling for collapsed amend header** to indicate secondary importance:
   ```css
   .commit-info-view-main-content > .collapsable .collapsable-title {
     opacity: 0.8;
   }

   .commit-info-view-main-content > .collapsable .collapsable-title:hover {
     opacity: 1;
   }
   ```

**Visual effect:**
- Files Changed section has full visual weight (100% opacity, no special treatment)
- Changes to Amend header appears slightly subdued (80% opacity), indicating secondary importance
- Hover restores full opacity for clear interactivity
  </action>
  <verify>
- CSS syntax valid (no build errors)
- Visual inspection: Amend section header appears slightly muted compared to Files Changed
- Hover effect works on amend header
  </verify>
  <done>
- Clear visual hierarchy between primary and secondary sections
- Amend section feels like "advanced" or "secondary" action area
  </done>
</task>

</tasks>

<verification>
1. Start dev server: `cd addons/isl && yarn start`
2. Open ISL in browser
3. Select a commit with uncommitted changes (HEAD with pending changes)
4. Verify:
   - Files Changed section appears FIRST (above amend)
   - Changes to Amend section is COLLAPSED by default
   - Clicking Changes to Amend header expands it
   - Amend header has subtle visual de-emphasis
5. Select a different commit, then return to HEAD - amend section should be collapsed again
</verification>

<success_criteria>
- Files Changed section is visually prominent (first position)
- Changes to Amend section is de-emphasized (collapsed, subtle styling)
- User can still access amend functionality by expanding
- No regressions in existing tests
</success_criteria>

<output>
After completion, create `.planning/phases/04-details-panel/04-01-SUMMARY.md`
</output>
